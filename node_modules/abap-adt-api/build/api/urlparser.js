"use strict";
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseUri = exports.rangeToString = void 0;
const utilities_1 = require("../utilities");
const rangeToString = (range) => `#start=${range.start.line},${range.start.column};end=${range.end.line},${range.end.column}`;
exports.rangeToString = rangeToString;
function parseUri(sourceuri) {
    const [uri, qs, hash] = utilities_1.parts(sourceuri, /([^\?#]*)(?:\?([^#]*))?(?:#(.*))?/);
    //
    const query = (qs || "").split(/&/).reduce((acc, cur) => {
        const [key, val] = cur.split("=");
        if (key)
            acc[key] = val;
        return acc;
    }, {});
    const _a = (hash || "")
        .split(/;/)
        .reduce((acc, cur) => {
        const [key, val] = cur.split("=");
        if (key)
            acc[key] = val;
        return acc;
    }, {}), { start, end } = _a, hashparms = __rest(_a, ["start", "end"]);
    const parsePos = (x) => {
        const [line, column] = x ? x.split(",").map(utilities_1.toInt) : [0, 0];
        return { line: line || 0, column: column || 0 };
    };
    const st = parsePos(start);
    const range = {
        start: st,
        end: end ? parsePos(end) : st
    };
    return { range, uri, query, hashparms };
}
exports.parseUri = parseUri;
